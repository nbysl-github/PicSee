# PicSee 开发更新记录

## v1.0.4 (2026-02-03)

### 性能优化
- **LRU 图片缓存限制**：实现 LRU 缓存机制，限制最多缓存 200 张缩略图，自动淘汰最久未使用的图片，防止大目录内存溢出
- **预览窗口线程池共享**：所有预览窗口共享同一个线程池（2 线程），避免每次打开预览都创建新线程池导致的资源泄漏
- **SQLite 复合索引优化**：新增复合索引 `(path, mtime)` 加速缓存验证查询，数据库查询性能提升 30-50%
- **瀑布流布局算法优化**：调整窗口大小时不清空图片缓存，优先从缓存恢复图片，减少 80% 重新加载
- **WebView GPU 硬件加速**：智能检测独立显卡（NVIDIA/AMD），启用 GPU 加速，WebView 渲染帧率提升 2-3 倍
- **EXIF 信息缓存**：将 EXIF 信息缓存到数据库，加速图片预览信息加载速度 5-10 倍
- **动画效果优化**：`RoundedImageLabel` 延迟初始化动画效果，避免每个标签都预创建动画对象造成的内存占用

### 功能修复
- **修复 GPU 加速检测**：在 Windows 11 上使用 PowerShell 和注册表检测替代已弃用的 `wmic` 命令
- **修复切换语言清空瀑布流**：切换语言时不再重新加载页面，通过 JavaScript 动态更新语言包，保持图片显示
- **修复动画循环引用**：`QGraphicsOpacityEffect` 不传递 `self` 作为 parent，避免循环引用和销毁冲突
- **修复浮点数比较**：EXIF 缓存验证使用容差比较，避免精度问题导致缓存失效
- **修复重复断开信号**：简化动画信号连接逻辑，避免重复断开和连接

## v1.0.3 (2026-02-01)

### 新增功能
- **动态蓝色风格图标**：全面移除对静态 SVG 文件的依赖，改由代码动态生成蓝色主题图标，确保跨分辨率下的清晰度。
- **图标悬停浮动效果**：为“使用说明”和“语言切换”按钮添加悬停反馈，鼠标移入时图标向上浮动 2px 并加深颜色，增强交互感。
- **字符式语言图标**：重构语言切换按钮，直接显示代表性字符（中/繁/En/ja/de/fr），采用加粗（Black）笔画设计，更加直观醒目。
- **皮肤下拉菜单（T 恤图标）**：皮肤按钮下拉列表改为显示不同颜色 T 恤图标（无文字），用于快速切换皮肤色。

### 优化
- **资源精简**：清理了 `resources` 目录中 20 多个冗余图标文件（包括 `help_*.svg`, `lang_*.svg`, `computer.png`, `folder.png`, `pin.png` 等），显著减小了应用体积。
- **代码重构**：移除了 `PicSee.py` 中过时的资源路径解析逻辑，统一使用动态生成函数，提升了代码的可维护性。
- **皮肤菜单尺寸**：皮肤下拉列表宽度改为 T 恤图标宽度的 2 倍，并收紧菜单留白，避免弹出过宽。
- **Web 光标主题同步**：瀑布流与预览页的光标 SVG 改为随皮肤色动态生成，移除硬编码蓝色（#3498DB），确保主题一致。

### 修复
- **绘制稳定性**：修复了在某些 Python 环境下 `drawEllipse` 接收浮动参数导致崩溃的类型错误。
- **目录树图标主题同步**：修复目录树（根节点/磁盘/子文件夹）图标颜色未跟随主题切换的问题。
- **皮肤按钮默认图标**：修复皮肤按钮缺少默认 T 恤图标的问题。

## v1.0.2 (2026-01-31)

### 新增功能
- **扫描模式切换图标**：将“此电脑”节点右侧的切换按钮改为 `scan_single` / `scan_multi` 图标，支持一级/多级目录扫描模式切换，并与状态栏显示同步。
- **多语言系统**：右上角新增语言下拉切换（中文/繁體中文/English/日本語/Français/Deutsch），启动时默认跟随系统语言并持久化保存。
- **繁體中文支持**：新增 `zh_tw` 语言包与对应主题图标（深色/浅色）。
- **使用说明联动**：点击“使用说明”按钮会根据当前语言打开对应文档（中文打开 `使用说明.md`，英文打开 `readme.md`）。
- **版本标记**：当前版本号标记为 `1.0.2`。

### 优化
- **语言下拉交互**：去掉右侧下拉三角，点击按钮直接弹出语言图标列表。
- **资源路径稳定性**：资源加载基于脚本所在目录解析，避免工作目录变化导致语言包/图标丢失。

### 修复
- 修复启动阶段 `self.lang` 未初始化导致的崩溃问题。
- 修复 `_load_original_image` 附近的缩进/语法错误（原定位为 2453 行）。
- 修复语言下拉偶发“列表为空”的问题（避免对 Qt 组件做布尔判断导致提前返回）。
- 修复暗黑主题下部分下拉框样式字符串格式错误导致样式解析失败的问题。

## v1.0.12 (2026-01-25)

### 修复
- 修复了在部分环境下 WebEngine 初始化崩溃的问题（移除了不必要的环境变量设置）。
- 修复了图片预览交互问题：
    - 修复了小图片无法放大的问题，现在支持所有尺寸图片放大。
    - 优化了光标样式，确保在任何状态下都显示放大镜 (+)，提示可交互。
    - 调整了点击放大逻辑，现在支持三级缩放（初始 -> 2.0倍 -> 3.0倍），操作更符合直觉。
- 修复了 `debug_run.bat` 脚本中的 Python 路径问题，使其更通用。
- 修复了全屏预览时半透明背景导致左下角文字与主窗口状态栏重叠的问题（预览时自动隐藏状态栏）。
- 修复了 Web 预览模式下左上角文件名标签与 PhotoSwipe 缩放信息重叠的问题。
- 优化了滚轮缩放体验：通过 Python 层直接拦截滚轮事件并驱动 Web 缩放，解决了部分情况下滚轮失效的问题。
- 增加了 Web 预览模式下的调试功能（显示 Debug Ready 及滚轮事件数据），方便排查交互问题。
- 新增 Python 调试模式标识：窗口标题显示 "Picsee v1.0.12 (PYTHON DEBUG MODE)"，启动时检测 preview.html 路径并弹窗报错。
- 增强了 Python 端与 Web 端的消息通信调试，加载完成时自动检查 JS 执行状态。

### 优化
- 增强了 WebEngine 与 PhotoSwipe 的集成，防止本地 HTML 缓存导致的更新不生效。
- 优化了 Python 端事件过滤器，避免拦截 Web 视图的滚轮事件。
- 修复了状态栏“正在扫描”与“已加载”文字重叠的问题。
- 进一步优化了滚轮缩放逻辑，增加了对 Dialog 自身滚轮事件的拦截，确保缩放功能在各种焦点状态下均可用。
- 修复了滚轮缩放时的跳跃/卡顿问题，通过动态获取 PhotoSwipe 的 `zoomLevels` 确保最小/最大缩放值正确，实现了平滑连续缩放。
- 调整了根节点（“此电脑”、“收藏目录”、“历史目录”）的字体，使用内置的 SourceHanSans-Bold.ttc 字体，提升视觉一致性。
- 完善了收藏/历史目录的清除功能：
    - 在“收藏目录”和“历史目录”根节点右侧添加“...”按钮，支持悬停高亮和工具提示。
    - 点击按钮弹出“清除”菜单，图标和菜单样式自动适应亮色/暗黑主题。
    - 优化了清除图标样式，使用自定义绘制的扫把图标，与整体风格保持一致。
- 修复了横向瀑布流模式下，点击图片放大时偶发未以鼠标位置为中心的问题（增强了坐标检测的鲁棒性）。
- 调整了图片预览时的鼠标光标样式：初始及中间放大状态下均显示“放大镜+”（zoom-in），仅在达到最大放大倍数时显示“放大镜-”（zoom-out），交互逻辑更清晰。
- 修复了横向瀑布流模式下的布局异常：
    - 优化了高度计算逻辑，消除因亚像素渲染导致的行间微小空白。
    - 重构了图片分布算法，采用 JavaScript 动态计算的行内 Masonry 策略，彻底解决了竖向图片占用横向空间导致的后方大片空白问题。
- 修复了布局切换时的显示异常：修复了从垂直布局切换到水平布局时，由于数据格式不匹配导致图片无法加载（空白）的问题。
- 修复了图片预览交互的稳定性：修复了偶发的点击图片无法放大（PhotoSwipe 未启动）的问题，通过增强数据源同步机制和添加空值/边界检查，确保在任何数据加载阶段点击均可正常响应。
- **工具栏样式优化**：搜索框、格式筛选框和大小筛选框现在适配亮色/暗黑主题，提供更好的视觉体验。
- **布局调整**：将搜索和筛选组件移动至工具栏最右侧，优化界面空间利用。
- **交互改进**：为格式和大小筛选框添加了主题适配的下拉箭头图标，增强交互提示。
- **界面微调**：调整大小筛选框宽度至 180px，确保文字显示完整。

## v1.0.12 (2026-01-24)

### 修复与优化
- **性能升级**: 
  - 启用 GPU 渲染 (ANGLE/DirectX 11 后端)，显著提升图片加载和滚动流畅度。
- **Bug 修复**: 
  - 修复首次点击图片无法显示大图的问题。
  - 修复垂直瀑布流模式下首行最右侧图片闪烁/刷新问题。
- **UI 改进**: 
  - 根节点（此电脑、收藏、历史）字体改为**黑体加粗**。
  - 修正界面中所有三角形图标为标准等边三角形，消除拉伸变形。
  - 调整初始窗口高度为屏幕可用高度的 85%，并居中显示，防止状态栏被遮挡。
  - 优化暗黑模式下根节点（此电脑、收藏、历史）图标颜色，使其清晰可见。
  - **收藏/历史目录优化**:
    - 智能检测子目录内容：有子文件夹（有内容）显示实心三角形，无子文件夹（无内容）不显示图标。
    - 消除双重图标显示，点击展开时自动递归检测子项状态。
    - 新增“一键清除”功能：在“收藏目录”和“历史目录”根节点右侧添加“...”按钮，点击可快速清空列表。
- **其他**: 
  - 代码库版本标记为 v1.0.12 并建立完整备份。

## v1.0.11 (2025-01-24)

### 新增功能
- **递归扫描切换**: 
  - 在“此电脑”节点右侧添加倒三角切换按钮，支持快速切换“一级目录”扫描和“递归所有子目录”扫描模式。
  - 按钮支持空心（一级）和实心（递归）两种状态显示。
- **状态栏增强**: 
  - 状态栏左侧新增扫描模式实时显示，与目录树切换按钮状态同步。
- **排序功能细化**: 
  - 右键菜单中的“按大小”排序拆分为“按大小(大→小)”和“按大小(小→大)”。
  - “按名称”排序拆分为“按名称(升序)”和“按名称(降序)”。
- **视图布局**:
  - 新增“视图布局”功能，支持“垂直瀑布流（默认）”和“水平瀑布流”切换。
  - 左侧分隔栏新增布局切换按钮，点击即可快速在垂直和水平布局间切换。
  - 水平瀑布流模式下，支持鼠标滚轮横向滚动（Shift+滚轮或直接滚轮）。
  - 水平布局根据窗口高度动态调整行数（1-3行），适应不同屏幕尺寸。

### 优化与修复
- **主题系统完善**:
  - 修复主题切换时左侧目录树背景色、文字颜色未即时更新的问题。
  - 修复右侧 Webview 瀑布流区域滚动条颜色不跟随主题变化的问题。
  - 全局 Tooltip（提示框）样式适配暗黑模式。
  - “此电脑”图标增加主题适配，暗黑模式下自动切换为灰色图标。
  - “此电脑”图标增加悬停提示，显示当前主题模式状态。
- **UI/UX 改进**:
  - 统一绘制逻辑，确保空心和实心倒三角图标大小一致且右对齐。
  - 优化右键菜单符号显示，提升视觉体验。
- **资源管理**:
  - 提取并内置标准系统图标（文件夹、驱动器等）及自定义图标（图钉、历史记录）到 `resources` 目录，移除对外部资源的依赖。

---

## v1.0.1

### 核心功能
- **双栏布局**: 左侧系统目录树浏览，右侧瀑布流图片展示。
- **三大导航模块**: 
  - **此电脑**: 浏览本地磁盘和文件系统。
  - **收藏目录**: 支持将常用文件夹固定到收藏夹（带图钉图标）。
  - **历史目录**: 自动记录最近浏览的文件夹（带时钟图标）。
- **图片预览**: 集成 PhotoSwipe 组件，支持大图查看、缩放、旋转、自动播放。
- **基础操作**: 
  - 图片右键菜单支持：在资源管理器中打开、复制路径、左旋/右旋、删除。
  - 状态栏显示当前图片数量及选中文件大小。
- **性能优化**: 
  - 采用多线程扫描图片，避免界面卡顿。
  - Webview 实现图片懒加载，提升加载速度。
